<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form with JS</title>
    <link rel="stylesheet" href="form-no-js.css">
</head>
<body>
    <button id="theme-toggle" type="button" aria-pressed="false" aria-label="Toggle dark mode">
      ðŸŒ™ Dark mode
    </button>
    <section id="contact">
      <form action="https://httpbin.org/post" method="post">
        <fieldset>
          <legend>Contact <span>Me</span></legend>

          <form-field>
            <label for="fullName">Full Name: </label>
            <input type="text" id="fullName" name="fullName" placeholder="Full Name" autocomplete="name" aria-describedby="fullName-error fullName-info" required>
            <output class="error" id="fullName-error" for="fullName" aria-live="polite"></output>
            <output class="info" id="fullName-info" for="fullName" aria-live="polite"></output>
          </form-field>

          <form-field>
            <label for="email">Email: </label>
            <input type="email" name="email" id="email" placeholder="Email" required autocomplete="email" aria-describedby="email-error email-info">
            <output class="error" id="email-error" for="email" aria-live="polite"></output>
            <output class="info" id="email-info" for="email" aria-live="polite"></output>
          </form-field>

          <form-field>
            <label for="comments">Comments: </label>
            <textarea name="comments" id="comments" placeholder="Your Comments" required aria-describedby="comments-error comments-info" maxlength="100"></textarea>
            <output class="error" id="comments-error" for="comments" aria-live="polite"></output>
            <output class="info" id="comments-info" for="comments" aria-live="polite"></output>
          </form-field>

          <input type="hidden" name="possible_bot" value="true">
          <button type="submit">Send Message</button>
        </fieldset>
        <output></output>
        <output></output>
      </form>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", () => {

            const fields = [
                {
                    el: document.getElementById("fullName"),
                    error: document.getElementById("fullName-error"),
                    pattern: /^[A-Za-zÃ€-Ã–Ã˜-Ã¶Ã¸-Ã¿ ,.'-]*$/,
                    message: "Illegal character. Only letters, spaces, and punctuation allowed"
                },
                {
                    el: document.getElementById("email"),
                    error: document.getElementById("email-error"),
                    message: "Enter a valid email address such as name@domain.com"
                }
            ];

            const form = document.querySelector("form");
            const hiddenErrors = document.createElement("input");
            hiddenErrors.type = "hidden";
            hiddenErrors.name = "form-errors";
            form.appendChild(hiddenErrors);

            const form_errors = [];

            function logError(field, message, value) {
                form_errors.push({field, message, value});
                hiddenErrors.value = JSON.stringify(form_errors);
            }


            fields.forEach( ({ el, error, pattern, message }) => {
                el.addEventListener("input", () => {
                    const invalid = (el.type === "email" && el.validity.typeMismatch) || (pattern && !pattern.test(el.value));
                    if (el.timerId) {
                        clearTimeout(el.timerId);
                        el.timerId = null;
                        el.classList.remove("flash");
                    }
                    if (invalid) {
                        el.classList.add("flash");
                        el.setCustomValidity(message);
                        error.textContent = message

                        el.timerId = setTimeout( () => {
                            el.classList.remove("flash");
                            error.textContent = "";
                            el.timerId = null;
                        }, 5000);
                    } else {
                        el.setCustomValidity("");
                        error.textContent = "";
                    }
                });

                el.addEventListener("invalid", () => {
                    logError(el.id, el.validationMessage, el.value);
                });

            });

            const textArea = document.getElementById("comments");
            const errorOutput = document.getElementById("comments-error");
            const infoOutput = document.getElementById("comments-info");
            const max = textArea.maxLength;

            textArea.addEventListener("input", () => {
                const remaining = max - textArea.value.length;
                infoOutput.textContent = `${remaining} characters remaining`;

                textArea.classList.remove("flash");
                errorOutput.textContent = "";

                if (remaining <= 0) {
                    infoOutput.style.color = "#d33";
                    textArea.setCustomValidity("Character limit reached");
                    errorOutput.textContent = "Maximum character limit reached";
                } else if (remaining <= max*0.1) {
                    infoOutput.style.color = "#d98400";
                    textArea.setCustomValidity("");
                } else {
                    infoOutput.style.color = "#555";
                    textArea.setCustomValidity("");
                }
            });

            function setTheme(mode) {
                root.setAttribute("data-theme", mode);
                themeBtn.setAttribute("aria-pressed", String(mode === "dark"));
                themeBtn.textContent = (mode === "dark") ? "â˜€ï¸ Light Mode" : "ðŸŒ™ Dark Mode";
                localStorage.setItem(KEY, mode);
            }

            const KEY = "theme";
            const themeBtn = document.getElementById("theme-toggle");
            const root = document.documentElement;

            const saved = localStorage.getItem(KEY);
            const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
            const initial = saved || (prefersDark ? "dark" : "light");
            setTheme(initial);

            themeBtn.addEventListener("click", () => {
                const next = root.getAttribute("data-theme") === "dark" ? "light" : "dark";
                setTheme(next);
            });
        })
    </script>
    <noscript>
      <style>
        #theme-toggle {
          display: none !important;
        }
      </style>
    </noscript>
</body>
</html>